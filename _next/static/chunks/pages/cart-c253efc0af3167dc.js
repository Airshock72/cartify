(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{6764:(t,e,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return n(7905)}])},6133:(t,e,n)=>{"use strict";n.d(e,{DL:()=>m,TD:()=>c,q9:()=>u,uj:()=>o});var r=n(4577),a=n(6679);function i(){let t=(0,r._)(["\n    mutation RemoveItem($input: RemoveItemArgs!) {\n        removeItem(input: $input) {\n            _id\n            hash\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return i=function(){return t},t}function s(){let t=(0,r._)(["\n    mutation UpdateItemQuantity($input: UpdateItemQuantityArgs!) {\n        updateItemQuantity(input: $input) {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return s=function(){return t},t}function d(){let t=(0,r._)(["\n    mutation Register {\n        register {\n            _id\n            token\n        }\n    }\n"]);return d=function(){return t},t}function l(){let t=(0,r._)(["\n    mutation AddItem($input: AddItemArgs!) {\n        addItem(input: $input) {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return l=function(){return t},t}let c=(0,a.J1)(i()),o=(0,a.J1)(s()),u=(0,a.J1)(d()),m=(0,a.J1)(l())},2660:(t,e,n)=>{"use strict";n.d(e,{Br:()=>o,oH:()=>c,si:()=>l});var r=n(4577),a=n(6679);function i(){let t=(0,r._)(["\n    query GetCart {\n        getCart {\n            _id\n            hash\n            items {\n                _id\n                product {\n                    _id\n                    title\n                    cost\n                    availableQuantity\n                }\n                quantity\n            }\n        }\n    }\n"]);return i=function(){return t},t}function s(){let t=(0,r._)(["\n    query GetProducts {\n        getProducts {\n            products {\n                _id\n                title\n                cost\n                availableQuantity\n            }\n            total\n        }\n    }\n"]);return s=function(){return t},t}function d(){let t=(0,r._)(["\n    query GetCart {\n        getCart {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                }\n            }\n        }\n    }\n"]);return d=function(){return t},t}let l=(0,a.J1)(i()),c=(0,a.J1)(s()),o=(0,a.J1)(d())},2500:(t,e,n)=>{"use strict";n.d(e,{H4:()=>s,IE:()=>l,Pw:()=>d});var r=n(4476),a=n(7761),i=n.n(a);let s=r.z.object({cartItemId:r.z.string().refine(t=>i().isMongoId(t),"Invalid cart item ID"),quantity:r.z.number().min(1)}),d=r.z.object({cartItemId:r.z.string().refine(t=>i().isMongoId(t),"Invalid cart item ID")}),l=r.z.object({productId:r.z.string().refine(t=>i().isMongoId(t),"Invalid product ID"),quantity:r.z.number().min(1)})},7905:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>I});var r=n(4848),a=n(6543),i=n(7861),s=n(6540),d=n(6715),l=n(8195),c=n(5420),o=n(8071),u=n(3093),m=n(4476),h=n(2500),p=n(2660),v=n(6133),x=n(4577);function _(){let t=(0,x._)(["\n    subscription CartItemUpdate {\n        cartItemUpdate {\n            event\n            payload {\n                _id\n                product {\n                    _id\n                    title\n                    cost\n                    availableQuantity\n                }\n                quantity\n            }\n        }\n    }\n"]);return _=function(){return t},t}let b=(0,n(6679).J1)(_()),y=()=>{var t;let{data:e,loading:n,error:r,refetch:a}=(0,l.IT)(p.si,{pollInterval:5e3}),[i]=(0,c.n)(v.TD),[x]=(0,c.n)(v.uj),[_,y]=(0,s.useState)({}),[f,j]=(0,s.useState)(null),[g,N]=(0,s.useState)([]),[I,C]=(0,s.useState)(!1),[w,k]=(0,s.useState)(null),R=(0,d.useRouter)(),[q,E]=(0,s.useState)((null==e?void 0:null===(t=e.getCart)||void 0===t?void 0:t.items)||[]),Q=(0,s.useRef)({});return(0,o.R)(b,{onData:t=>{let{data:e}=t,{event:n,payload:r}=e.data.cartItemUpdate;N(t=>[...t,{event:n,item:r}]),C(!0),a().then()}}),(0,s.useEffect)(()=>{localStorage.getItem("visitorToken")||R.push("/register").then()},[R]),(0,s.useEffect)(()=>{var t;(null==e?void 0:null===(t=e.getCart)||void 0===t?void 0:t.items)&&(E(e.getCart.items),e.getCart.items.forEach(t=>{Q.current[t._id]||(Q.current[t._id]=(0,s.createRef)())}))},[e]),{loading:n,error:r,updatingItemId:f,quantities:_,handleUpdateQuantity:(t,n)=>{var r,a;try{h.H4.parse({cartItemId:t,quantity:n});let a=null==e?void 0:null===(r=e.getCart)||void 0===r?void 0:r.items.find(e=>e._id===t);if(a&&n>a.product.availableQuantity){u.oR.error("Only ".concat(a.product.availableQuantity," items are available. Please choose a smaller quantity."));return}j(t),x({variables:{input:{cartItemId:t,quantity:n}}}).then(()=>u.oR.success("Quantity updated successfully!")).catch(()=>u.oR.error("Failed to update quantity.")).finally(()=>j(null))}catch(t){t instanceof m.z.ZodError&&u.oR.error(null===(a=t.errors[0])||void 0===a?void 0:a.message)}},setQuantities:y,cartUpdates:g,handleRemoveItem:t=>{try{h.Pw.parse({cartItemId:t}),k(t),i({variables:{input:{cartItemId:t}}}).then(()=>{u.oR.success("Item removed successfully!"),a().then()}).catch(()=>{u.oR.error("Failed to remove item.")}).finally(()=>k(null))}catch(t){var e;t instanceof m.z.ZodError&&u.oR.error(null===(e=t.errors[0])||void 0===e?void 0:e.message)}},removingItemId:w,showModal:I,handleAcknowledge:()=>{N([]),C(!1)},cartItems:q,itemRefs:Q}},f=()=>(0,r.jsx)("div",{className:"container mt-5 d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:(0,r.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"Loading..."})})});var j=n(1106),g=n.n(j);let N=t=>{let{cartUpdates:e,handleAcknowledge:n}=t;return(0,r.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,role:"dialog",children:(0,r.jsx)("div",{className:"modal-dialog",children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsx)("div",{className:"modal-header",children:(0,r.jsx)("h5",{className:"modal-title",children:"Cart Update"})}),(0,r.jsx)("div",{className:"modal-body",children:e.map(t=>{let{event:e,item:n}=t;return(0,r.jsxs)("p",{children:[n.product.title," - ","ITEM_OUT_OF_STOCK"===e?"Out of stock":"Quantity updated"]},n._id)})}),(0,r.jsx)("div",{className:"modal-footer",children:(0,r.jsx)("button",{className:"btn btn-primary",onClick:n,children:"OK"})})]})})})},I=()=>{let{loading:t,error:e,quantities:n,setQuantities:s,handleUpdateQuantity:d,updatingItemId:l,handleRemoveItem:c,removingItemId:o,showModal:u,cartUpdates:m,handleAcknowledge:h,cartItems:p,itemRefs:v}=y();return t?(0,r.jsx)(f,{}):e?(0,r.jsxs)("p",{className:"text-danger text-center mt-5",children:["Error: ",e.message]}):(0,r.jsxs)("div",{className:"container mt-5",children:[(0,r.jsx)("h2",{className:"mb-4 text-center fw-bold text-primary",children:"Your Cart"}),0===p.length?(0,r.jsx)("div",{className:"card text-center border-0 shadow-lg",children:(0,r.jsxs)("div",{className:"card-body bg-light py-5",children:[(0,r.jsx)("h5",{className:"card-title text-muted",children:"Your Cart is Empty"}),(0,r.jsx)("p",{className:"card-text text-muted mb-4",children:"It looks like you haven't added any items to your cart yet. Start shopping now!"}),(0,r.jsx)(g(),{href:"/",className:"btn btn-primary btn-lg",children:"Go to Products"})]})}):(0,r.jsx)(a.A,{component:null,children:p.map(t=>(0,r.jsx)(i.A,{timeout:300,classNames:"cart-item",nodeRef:v.current[t._id],children:(0,r.jsx)("div",{ref:v.current[t._id],className:"card mb-3 border-0 shadow-sm",children:(0,r.jsx)("div",{className:"card-body",children:(0,r.jsxs)("div",{className:"row align-items-center",children:[(0,r.jsxs)("div",{className:"col-md-8",children:[(0,r.jsx)("h5",{className:"card-title fw-bold text-dark",children:t.product.title}),(0,r.jsxs)("p",{className:"card-text text-muted",children:[(0,r.jsx)("span",{className:"fw-bold",children:"Price: "}),"$",t.product.cost.toFixed(2)]})]}),(0,r.jsx)("div",{className:"col-md-4",children:(0,r.jsxs)("div",{className:"d-flex align-items-center justify-content-end",children:[(0,r.jsx)("input",{type:"number",className:"form-control me-2 text-center",style:{width:"80px"},value:n[t._id]||t.quantity,onChange:e=>s({...n,[t._id]:parseInt(e.target.value)}),min:"1"}),(0,r.jsx)("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>d(t._id,n[t._id]||t.quantity),disabled:l===t._id,children:l===t._id?(0,r.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):"Update"}),(0,r.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>c(t._id),disabled:o===t._id,children:o===t._id?(0,r.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):"Remove"})]})})]})})})},t._id))}),p.length>0&&(0,r.jsxs)("div",{className:"text-end mt-4",children:[(0,r.jsxs)("h4",{className:"fw-bold text-dark",children:["Total: $",p.reduce((t,e)=>t+e.product.cost*(n[e._id]||e.quantity),0).toFixed(2)]}),(0,r.jsx)("button",{className:"btn btn-primary btn-lg mt-3",children:"Checkout"})]}),u&&(0,r.jsx)(N,{cartUpdates:m,handleAcknowledge:h})]})}}},t=>{var e=e=>t(t.s=e);t.O(0,[348,790,981,636,593,792],()=>e(6764)),_N_E=t.O()}]);