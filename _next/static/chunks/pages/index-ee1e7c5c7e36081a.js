(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(t,n,e)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return e(8873)}])},6133:(t,n,e)=>{"use strict";e.d(n,{DL:()=>m,TD:()=>u,q9:()=>l,uj:()=>o});var i=e(4577),r=e(6679);function s(){let t=(0,i._)(["\n    mutation RemoveItem($input: RemoveItemArgs!) {\n        removeItem(input: $input) {\n            _id\n            hash\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return s=function(){return t},t}function a(){let t=(0,i._)(["\n    mutation UpdateItemQuantity($input: UpdateItemQuantityArgs!) {\n        updateItemQuantity(input: $input) {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return a=function(){return t},t}function d(){let t=(0,i._)(["\n    mutation Register {\n        register {\n            _id\n            token\n        }\n    }\n"]);return d=function(){return t},t}function c(){let t=(0,i._)(["\n    mutation AddItem($input: AddItemArgs!) {\n        addItem(input: $input) {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                    title\n                }\n                quantity\n            }\n        }\n    }\n"]);return c=function(){return t},t}let u=(0,r.J1)(s()),o=(0,r.J1)(a()),l=(0,r.J1)(d()),m=(0,r.J1)(c())},2660:(t,n,e)=>{"use strict";e.d(n,{Br:()=>o,oH:()=>u,si:()=>c});var i=e(4577),r=e(6679);function s(){let t=(0,i._)(["\n    query GetCart {\n        getCart {\n            _id\n            hash\n            items {\n                _id\n                product {\n                    _id\n                    title\n                    cost\n                    availableQuantity\n                }\n                quantity\n            }\n        }\n    }\n"]);return s=function(){return t},t}function a(){let t=(0,i._)(["\n    query GetProducts {\n        getProducts {\n            products {\n                _id\n                title\n                cost\n                availableQuantity\n            }\n            total\n        }\n    }\n"]);return a=function(){return t},t}function d(){let t=(0,i._)(["\n    query GetCart {\n        getCart {\n            _id\n            items {\n                _id\n                product {\n                    _id\n                }\n            }\n        }\n    }\n"]);return d=function(){return t},t}let c=(0,r.J1)(s()),u=(0,r.J1)(a()),o=(0,r.J1)(d())},2500:(t,n,e)=>{"use strict";e.d(n,{H4:()=>a,IE:()=>c,Pw:()=>d});var i=e(4476),r=e(7761),s=e.n(r);let a=i.z.object({cartItemId:i.z.string().refine(t=>s().isMongoId(t),"Invalid cart item ID"),quantity:i.z.number().min(1)}),d=i.z.object({cartItemId:i.z.string().refine(t=>s().isMongoId(t),"Invalid cart item ID")}),c=i.z.object({productId:i.z.string().refine(t=>s().isMongoId(t),"Invalid product ID"),quantity:i.z.number().min(1)})},8873:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>b});var i=e(4848),r=e(8195),s=e(5420),a=e(6540),d=e(3093),c=e(4476),u=e(2500),o=e(2660),l=e(6133);let m=()=>{let{data:t,loading:n,error:e}=(0,r.IT)(o.oH),{data:i,refetch:m}=(0,r.IT)(o.Br),[p]=(0,s.n)(l.DL),[v,_]=(0,a.useState)([]),[h,f]=(0,a.useState)([]),[b,g]=(0,a.useState)({}),x=async t=>{if(g(n=>({...n,[t]:!0})),v.includes(t)){d.oR.info("Product already in the cart!");return}if(h.includes(t)){d.oR.error("This product is out of stock!");return}try{u.IE.parse({productId:t,quantity:1}),await p({variables:{input:{productId:t,quantity:1}}}),_(n=>[...n,t]),d.oR.success("Product added to cart!"),await m()}catch(t){if(t instanceof c.z.ZodError){var n;d.oR.error(null===(n=t.errors[0])||void 0===n?void 0:n.message)}else console.error("Error adding product to cart:",t),d.oR.error("Error adding product to cart!")}finally{g(n=>({...n,[t]:!1}))}};return(0,a.useEffect)(()=>{var t;(null==i?void 0:null===(t=i.getCart)||void 0===t?void 0:t.items)&&_(i.getCart.items.map(t=>t.product._id))},[i]),(0,a.useEffect)(()=>{var n;if(null==t?void 0:null===(n=t.getProducts)||void 0===n?void 0:n.products){let n=t.getProducts.products.filter(t=>0===t.availableQuantity).map(t=>t._id);n.length>0&&f(n)}},[t]),{data:t,loading:n,error:e,addedToCart:v,handleAddToCart:x,loadingStates:b}},p=()=>(0,i.jsx)("div",{className:"d-flex justify-content-center mt-5",children:(0,i.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,i.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}),v=t=>{let{message:n}=t;return(0,i.jsxs)("div",{className:"text-center text-danger mt-5",children:[(0,i.jsxs)("p",{children:["Error: ",n]}),(0,i.jsx)("button",{className:"btn btn-danger",onClick:()=>window.location.reload(),children:"Retry"})]})},_=()=>{var t;let{loading:n,error:e,data:r,addedToCart:s,handleAddToCart:a,loadingStates:d}=m();return n?(0,i.jsx)(p,{}):e?(0,i.jsx)(v,{message:e.message}):(0,i.jsxs)("div",{className:"container mt-5",children:[(0,i.jsx)("h2",{className:"mb-4 text-center",children:"Products"}),(0,i.jsx)("div",{className:"row",children:null==r?void 0:null===(t=r.getProducts)||void 0===t?void 0:t.products.map(t=>(0,i.jsx)("div",{className:"col-md-4 mb-4",children:(0,i.jsx)("div",{className:"card shadow-sm bg-light",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title text-primary",children:t.title}),(0,i.jsxs)("p",{className:"card-text fw-bold",children:["$",t.cost.toFixed(2)]}),(0,i.jsxs)("p",{className:"card-text",children:["Available: ",t.availableQuantity]}),0===t.availableQuantity?(0,i.jsxs)("button",{className:"btn btn-danger",disabled:!0,children:[(0,i.jsx)("i",{className:"bi bi-x-circle"})," Out of Stock"]}):(0,i.jsx)("button",{className:"btn ".concat(s.includes(t._id)?"btn-success":"btn-primary"),onClick:()=>a(t._id),disabled:d[t._id]||s.includes(t._id),children:d[t._id]?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Adding..."]}):s.includes(t._id)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{className:"bi bi-check-circle"})," Added"]}):"Add to Cart"})]})})},t._id))})]})};var h=e(6715);let f=()=>{let t=(0,h.useRouter)();(0,a.useEffect)(()=>{localStorage.getItem("visitorToken")||t.push("/register").then()},[t])},b=()=>(f(),(0,i.jsx)("div",{children:(0,i.jsx)(_,{})}))}},t=>{var n=n=>t(t.s=n);t.O(0,[348,790,636,593,792],()=>n(2022)),_N_E=t.O()}]);